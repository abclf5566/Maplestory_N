<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ê•ì‰πãË∞∑ÊΩõËÉΩËä±Ë≤ªË®àÁÆó</title>
    <style>
        :root {
            --bg-primary: #0f0f0f;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #252525;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --accent: #ff6b6b;
            --accent-hover: #ff5252;
            --border: #333;
            --success: #4caf50;
            --warning: #ff9800;
            --error: #f44336;
            --rare-color: #5dade2;
            --epic-color: #a569bd;
            --unique-color: #f1c40f;
            --legendary-color: #2ecc71;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 5px;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 1.5rem;
            background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .main-grid {
          display: grid;
          grid-template-columns: repeat(2, minmax(280px, 1fr));
          grid-template-rows: auto 2fr;
          gap: 10px;
          flex: 1;
          min-height: 0;
          max-height: calc(100vh - 60px);
        }

        .card {
            background-color: var(--bg-secondary);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .section-title {
            font-size: 0.9rem;
            margin-bottom: 8px;
            color: var(--text-primary);
            border-bottom: 2px solid var(--accent);
            padding-bottom: 4px;
        }

        .input-group {
            margin-bottom: 8px;
        }

        label {
            display: block;
            margin-bottom: 3px;
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        input[type="number"] {
            width: 100%;
            padding: 6px;
            border: 1px solid var(--border);
            border-radius: 4px;
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 0.85rem;
            transition: border-color 0.3s;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: var(--accent);
        }

        .radio-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 10px;
        }

        .radio-option {
            position: relative;
        }

        .radio-option input[type="radio"] {
            position: absolute;
            opacity: 0;
        }

        .radio-option label {
            display: block;
            padding: 8px;
            border: 2px solid var(--border);
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background-color: var(--bg-tertiary);
            margin-bottom: 0;
            font-size: 0.85rem;
        }

        /* ÈöéÁ¥öÂ∞àÂ±¨È°èËâ≤ÊïàÊûú */
        .radio-option input[type="radio"][value="1"]:checked + label {
            border-color: var(--rare-color);
            background-color: rgba(93, 173, 226, 0.1);
            color: var(--rare-color);
            box-shadow: 0 0 10px rgba(93, 173, 226, 0.3);
        }

        .radio-option input[type="radio"][value="2"]:checked + label {
            border-color: var(--epic-color);
            background-color: rgba(165, 105, 189, 0.1);
            color: var(--epic-color);
            box-shadow: 0 0 15px rgba(165, 105, 189, 0.4);
            text-shadow: 0 0 10px rgba(165, 105, 189, 0.6);
        }

        .radio-option input[type="radio"][value="3"]:checked + label {
            border-color: var(--unique-color);
            background-color: rgba(241, 196, 15, 0.1);
            color: var(--unique-color);
            box-shadow: 0 0 20px rgba(241, 196, 15, 0.5);
            animation: uniqueGlow 2s ease-in-out infinite;
        }

        .radio-option input[type="radio"][value="4"]:checked + label {
            border-color: var(--legendary-color);
            background-color: rgba(46, 204, 113, 0.1);
            color: var(--legendary-color);
            box-shadow: 0 0 25px rgba(46, 204, 113, 0.6);
            animation: legendaryGlow 1.5s ease-in-out infinite;
        }

        @keyframes uniqueGlow {
            0%, 100% {
                text-shadow: 0 0 10px rgba(241, 196, 15, 0.8),
                            0 0 20px rgba(241, 196, 15, 0.6),
                            0 0 30px rgba(241, 196, 15, 0.4);
            }
            50% {
                text-shadow: 0 0 20px rgba(241, 196, 15, 1),
                            0 0 30px rgba(241, 196, 15, 0.8),
                            0 0 40px rgba(241, 196, 15, 0.6);
            }
        }

        @keyframes legendaryGlow {
            0%, 100% {
                text-shadow: 0 0 10px rgba(46, 204, 113, 0.8),
                            0 0 20px rgba(46, 204, 113, 0.6),
                            0 0 30px rgba(46, 204, 113, 0.4);
            }
            50% {
                text-shadow: 0 0 20px rgba(46, 204, 113, 1),
                            0 0 30px rgba(46, 204, 113, 0.8),
                            0 0 40px rgba(46, 204, 113, 0.6);
            }
        }

        .results {
            display: none;
            animation: fadeIn 0.5s;
            overflow-y: auto;
            flex: 1;
        }
        
        .results-container {
          grid-column: 1 / -1;
          grid-row: 2 / 3;
          display: flex;
          flex-direction: column;
        }
        
        .results {
          display: flex;
          flex: 1;
          overflow-y: auto;
        }
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ÈöéÁ¥öÂç°ÁâáÊ®£Âºè */
        .stage-cards {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .stage-card {
            flex: 1;
            min-width: 150px;
            background-color: var(--bg-tertiary);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .stage-card.rare-to-epic {
            border-color: var(--epic-color);
            background: linear-gradient(135deg, rgba(93, 173, 226, 0.1), rgba(165, 105, 189, 0.1));
        }

        .stage-card.epic-to-unique {
            border-color: var(--unique-color);
            background: linear-gradient(135deg, rgba(165, 105, 189, 0.1), rgba(241, 196, 15, 0.1));
        }

        .stage-card.unique-to-legendary {
            border-color: var(--legendary-color);
            background: linear-gradient(135deg, rgba(241, 196, 15, 0.1), rgba(46, 204, 113, 0.1));
        }

        .stage-title {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .cube-name {
            font-size: 0.85rem;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .stage-stats {
            display: flex;
            justify-content: space-around;
            font-size: 0.7rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            display: block;
            font-weight: bold;
            font-size: 0.8rem;
            color: var(--text-primary);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.65rem;
        }

        /* Á∏ΩÁµêÊ®£ÂºèÈáçÊñ∞Ë®≠Ë®à */
        .summary {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1) 0%, rgba(254, 202, 87, 0.1) 100%);
            border: 2px solid var(--accent);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .summary-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .rank-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
        }

        .rank-badge.rare {
            background-color: rgba(93, 173, 226, 0.2);
            color: var(--rare-color);
            border: 1px solid var(--rare-color);
        }

        .rank-badge.epic {
            background-color: rgba(165, 105, 189, 0.2);
            color: var(--epic-color);
            border: 1px solid var(--epic-color);
        }

        .rank-badge.unique {
            background-color: rgba(241, 196, 15, 0.2);
            color: var(--unique-color);
            border: 1px solid var(--unique-color);
        }

        .rank-badge.legendary {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--legendary-color);
            border: 1px solid var(--legendary-color);
        }

        .arrow {
            color: var(--accent);
            font-size: 1.2rem;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            text-align: center;
        }

        .summary-stat {
            background-color: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 6px;
        }

        .summary-stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .summary-stat-value {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--accent);
        }

        .cost-formatted {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .error-message {
            background-color: rgba(244, 67, 54, 0.1);
            border: 2px solid var(--error);
            color: var(--error);
            padding: 6px;
            border-radius: 4px;
            margin-top: 8px;
            text-align: center;
            display: none;
            font-size: 0.75rem;
        }


        /* ÊâãÊ©üÂÑ™Âåñ */
        @media (max-width: 600px) {
            .container {
                height: auto;
                min-height: 100vh;
                padding: 5px;
            }

            h1 {
                font-size: 1.2rem;
                margin-bottom: 8px;
            }

            .main-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .card {
                padding: 10px;
            }

            .radio-group {
                grid-template-columns: 1fr;
            }
        }

        /* ÁµêÊûúÂÆπÂô®ÊªæÂãïÊ¢ùÊ®£Âºè */
        .results::-webkit-scrollbar {
            width: 6px;
        }

        .results::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 3px;
        }

        .results::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 3px;
        }

        .results::-webkit-scrollbar-thumb:hover {
            background: var(--accent-hover);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üçÅ Ê•ì‰πãË∞∑ÊΩõËÉΩËä±Ë≤ªË®àÁÆó üçÅ</h1>

        <div class="main-grid">
            <!-- ÊñπÂ°äÂÉπÊ†ºË®≠ÂÆö -->
            <div class="card">
                <h2 class="section-title">ÊñπÂ°äÂÉπÊ†ºË®≠ÂÆö</h2>
                <div class="input-group">
                    <label for="occultPrice">Occult Cube ÂÉπÊ†º</label>
                    <input type="number" id="occultPrice" min="0" step="0.01" placeholder="Ëº∏ÂÖ•ÂÉπÊ†º" oninput="autoCalculate()" onchange="autoCalculate()">
                </div>
                <div class="input-group">
                    <label for="redPrice">Red Cube ÂÉπÊ†º</label>
                    <input type="number" id="redPrice" min="0" step="0.01" placeholder="Ëº∏ÂÖ•ÂÉπÊ†º" oninput="autoCalculate()" onchange="autoCalculate()">
                </div>
                <div class="input-group">
                    <label for="blackPrice">Black Cube ÂÉπÊ†º</label>
                    <input type="number" id="blackPrice" min="0" step="0.01" placeholder="Ëº∏ÂÖ•ÂÉπÊ†º" oninput="autoCalculate()" onchange="autoCalculate()">
                </div>
            </div>

            <!-- ÈöéÁ¥öË®≠ÂÆö -->
            <div class="card">
                <h2 class="section-title">ÈöéÁ¥öË®≠ÂÆö</h2>
                <div class="input-group">
                    <label>Áï∂ÂâçË£ùÂÇôÈöéÁ¥ö</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="currentRare" name="current" value="1" onchange="autoCalculate()">
                            <label for="currentRare">Rare</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="currentEpic" name="current" value="2" onchange="autoCalculate()">
                            <label for="currentEpic">Epic</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="currentUnique" name="current" value="3" onchange="autoCalculate()">
                            <label for="currentUnique">Unique</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="currentLegendary" name="current" value="4" onchange="autoCalculate()">
                            <label for="currentLegendary">Legendary</label>
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <label>ÁõÆÊ®ôË£ùÂÇôÈöéÁ¥ö</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="targetRare" name="target" value="1" onchange="autoCalculate()">
                            <label for="targetRare">Rare</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="targetEpic" name="target" value="2" onchange="autoCalculate()">
                            <label for="targetEpic">Epic</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="targetUnique" name="target" value="3" onchange="autoCalculate()">
                            <label for="targetUnique">Unique</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="targetLegendary" name="target" value="4" onchange="autoCalculate()">
                            <label for="targetLegendary">Legendary</label>
                        </div>
                    </div>
                </div>
                <div class="error-message" id="errorMessage"></div>
            </div>

            <!-- Ë®àÁÆóÁµêÊûú -->
            <div class="card results-container">
                <h2 class="section-title">Ë®àÁÆóÁµêÊûú</h2>
                <div class="results" id="results">
                    <div id="resultContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ÂêÑÊñπÂ°äÂçáÁ¥öÊ©üÁéáÔºà%Ôºâ
        const probs = {
            "Occult Cube": {"Rare‚ÜíEpic": 0.9901},
            "Red Cube": {
                "Rare‚ÜíEpic": 6.0,
                "Epic‚ÜíUnique": 1.8,
                "Unique‚ÜíLegendary": 0.3
            },
            "Black Cube": {
                "Rare‚ÜíEpic": 15.0,
                "Epic‚ÜíUnique": 3.5,
                "Unique‚ÜíLegendary": 1.0
            }
        };

        const rankMap = {
            '1': 'Rare',
            '2': 'Epic',
            '3': 'Unique',
            '4': 'Legendary'
        };

        const rankMapChinese = {
            'Rare': 'Á®ÄÊúâ',
            'Epic': 'Âè≤Ë©©',
            'Unique': 'Áç®Áâπ',
            'Legendary': 'ÂÇ≥Ë™™'
        };

        const stageNames = ["Rare‚ÜíEpic", "Epic‚ÜíUnique", "Unique‚ÜíLegendary"];
        const idxMap = {'Rare': 0, 'Epic': 1, 'Unique': 2, 'Legendary': 3};

        // Âä†ÂÖ•Èò≤ÊäñÊ©üÂà∂‰ª•ÊèêÂçáÊïàËÉΩ
        let calculateTimeout;
        
        function autoCalculate() {
            // Ê∏ÖÈô§‰πãÂâçÁöÑË®àÊôÇÂô®
            clearTimeout(calculateTimeout);
            
            // Ê∏ÖÈô§ÈåØË™§Ë®äÊÅØ
            document.getElementById('errorMessage').style.display = 'none';
            
            // Ë®≠ÂÆöÊñ∞ÁöÑË®àÊôÇÂô®ÔºåÂª∂ÈÅ≤100msÂü∑Ë°å
            calculateTimeout = setTimeout(() => {
                // Ê™¢Êü•ÊòØÂê¶ÊâÄÊúâÂøÖË¶ÅÁöÑËº∏ÂÖ•ÈÉΩÂ∑≤Â°´ÂØ´
                const occultPrice = document.getElementById('occultPrice').value;
                const redPrice = document.getElementById('redPrice').value;
                const blackPrice = document.getElementById('blackPrice').value;
                const currentRadio = document.querySelector('input[name="current"]:checked');
                const targetRadio = document.querySelector('input[name="target"]:checked');
                
                // Â¶ÇÊûúÊúâ‰ªª‰ΩïÂøÖË¶ÅËº∏ÂÖ•Êú™Â°´ÂØ´ÔºåÂâá‰∏çË®àÁÆó
                if (!occultPrice || !redPrice || !blackPrice || !currentRadio || !targetRadio) {
                    document.getElementById('results').style.display = 'none';
                    return;
                }
                
                // Âü∑Ë°åË®àÁÆó
                calculate();
            }, 100);
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            document.getElementById('results').style.display = 'none';
        }

        // Ê†ºÂºèÂåñÂ§ßÊï∏Â≠ó
        function formatNumber(num) {
            if (num >= 100000000) {
                return (num / 100000000).toFixed(2) + 'ÂÑÑ';
            } else if (num >= 10000) {
                return (num / 10000).toFixed(2) + 'Ëê¨';
            } else {
                return num.toFixed(2);
            }
        }

        // Ê†ºÂºèÂåñÊï∏Â≠óÂä†ÈÄóËôü
        function addCommas(num) {
            return num.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        function calculate() {
            // Ê∏ÖÈô§ÂÖàÂâçÁöÑÈåØË™§Ë®äÊÅØ
            document.getElementById('errorMessage').style.display = 'none';

            // ÂèñÂæóÂÉπÊ†º
            const costs = {
                "Occult Cube": parseFloat(document.getElementById('occultPrice').value),
                "Red Cube": parseFloat(document.getElementById('redPrice').value),
                "Black Cube": parseFloat(document.getElementById('blackPrice').value)
            };

            // Ê™¢Êü•ÂÉπÊ†ºÊòØÂê¶ÊúâÊïà
            if (isNaN(costs["Occult Cube"]) || isNaN(costs["Red Cube"]) || isNaN(costs["Black Cube"]) || 
                costs["Occult Cube"] <= 0 || costs["Red Cube"] <= 0 || costs["Black Cube"] <= 0) {
                showError('Ë´ãËº∏ÂÖ•ÊúâÊïàÁöÑÊñπÂ°äÂÉπÊ†ºÔºÅ');
                return;
            }

            // ÂèñÂæóÁï∂ÂâçÂíåÁõÆÊ®ôÈöéÁ¥ö
            const currentRadio = document.querySelector('input[name="current"]:checked');
            const targetRadio = document.querySelector('input[name="target"]:checked');

            if (!currentRadio || !targetRadio) {
                showError('Ë´ãÈÅ∏ÊìáÁï∂ÂâçÂíåÁõÆÊ®ôÈöéÁ¥öÔºÅ');
                return;
            }

            const curRank = rankMap[currentRadio.value];
            const tgtRank = rankMap[targetRadio.value];
            const curIdx = idxMap[curRank];
            const tgtIdx = idxMap[tgtRank];

            if (tgtIdx <= curIdx) {
                if (tgtIdx === curIdx) {
                    showError('Áï∂ÂâçÂ∑≤ÊòØÁõÆÊ®ôÈöéÁ¥öÔºåÁÑ°ÈúÄÂçáÈöéÔºÅ');
                } else {
                    showError('ÁõÆÊ®ôÈöéÁ¥ö‰∏çËÉΩ‰ΩéÊñºÁï∂ÂâçÈöéÁ¥öÔºÅ');
                }
                return;
            }

            let totalTries = 0;
            let totalCost = 0;
            let stageCardsHTML = '<div class="stage-cards">';

            // Ë®àÁÆóÊØèÂÄãÈöéÊÆµ
            for (let i = curIdx; i < tgtIdx; i++) {
                const stage = stageNames[i];
                const candidates = {};

                // ÁØ©ÈÅ∏ÂèØÁî®ÊñπÂ°ä
                for (const [cube, sp] of Object.entries(probs)) {
                    if (stage in sp && !(cube === "Occult Cube" && stage !== "Rare‚ÜíEpic")) {
                        const rate = sp[stage] / 100.0;
                        const avgTries = 1 / rate;
                        const avgCost = avgTries * costs[cube];
                        candidates[cube] = {tries: avgTries, cost: avgCost};
                    }
                }

                // ÊâæÂá∫ÊúÄ‰Ω≥ÊñπÊ°à
                let bestCube = null;
                let bestData = {cost: Infinity};

                for (const [cube, data] of Object.entries(candidates)) {
                    if (data.cost < bestData.cost) {
                        bestCube = cube;
                        bestData = data;
                    }
                }

                totalTries += bestData.tries;
                totalCost += bestData.cost;

                // Âà§Êñ∑ÈöéÊÆµÊ®£Âºè
                let stageClass = '';
                if (stage === 'Rare‚ÜíEpic') stageClass = 'rare-to-epic';
                else if (stage === 'Epic‚ÜíUnique') stageClass = 'epic-to-unique';
                else if (stage === 'Unique‚ÜíLegendary') stageClass = 'unique-to-legendary';

                stageCardsHTML += `
                    <div class="stage-card ${stageClass}">
                        <div class="stage-title">${stage}</div>
                        <div class="cube-name">${bestCube}</div>
                        <div class="stage-stats">
                            <div class="stat-item">
                                <span class="stat-value">${bestData.tries.toFixed(0)}</span>
                                <span class="stat-label">Ê¨°</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value">${formatNumber(bestData.cost)}</span>
                                <span class="stat-label">Ëä±Ë≤ª</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            stageCardsHTML += '</div>';

            // Á∏ΩÁµê
            const summaryHTML = `
                <div class="summary">
                    <div class="summary-header">
                        <span class="rank-badge ${curRank.toLowerCase()}">${rankMapChinese[curRank]}</span>
                        <span class="arrow">‚Üí</span>
                        <span class="rank-badge ${tgtRank.toLowerCase()}">${rankMapChinese[tgtRank]}</span>
                    </div>
                    <div class="summary-stats">
                        <div class="summary-stat">
                            <div class="summary-stat-label">Âπ≥ÂùáÁ∏ΩÊ¨°Êï∏</div>
                            <div class="summary-stat-value">${totalTries.toFixed(0)}</div>
                        </div>
                        <div class="summary-stat">
                            <div class="summary-stat-label">Âπ≥ÂùáÁ∏ΩËä±Ë≤ª</div>
                            <div class="summary-stat-value">${formatNumber(totalCost)}</div>
                            <div class="cost-formatted">${addCommas(totalCost)}</div>
                        </div>
                    </div>
                </div>
            `;

            // È°ØÁ§∫ÁµêÊûú
            document.getElementById('resultContent').innerHTML = stageCardsHTML + summaryHTML;
            document.getElementById('results').style.display = 'block';
        }

        // Enter ÈçµËß∏ÁôºË®àÁÆó
        document.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                autoCalculate();
            }
        });
    </script>
</body>
</html>
