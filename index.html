<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¥“ä¹‹è°·æ½›èƒ½èŠ±è²»è¨ˆç®—</title>
    <style>
        :root {
            --bg-primary: #0f0f0f;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #252525;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --accent: #ff6b6b;
            --accent-hover: #ff5252;
            --border: #333;
            --success: #4caf50;
            --warning: #ff9800;
            --error: #f44336;
            --rare-color: #5dade2;
            --epic-color: #a569bd;
            --unique-color: #f1c40f;
            --legendary-color: #2ecc71;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 5px;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 1.5rem;
            background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 280px 280px 1fr;
            gap: 10px;
            flex: 1;
            min-height: 0;
            max-height: calc(100vh - 60px);
        }

        .card {
            background-color: var(--bg-secondary);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .section-title {
            font-size: 0.9rem;
            margin-bottom: 8px;
            color: var(--text-primary);
            border-bottom: 2px solid var(--accent);
            padding-bottom: 4px;
        }

        .input-group {
            margin-bottom: 8px;
        }

        label {
            display: block;
            margin-bottom: 3px;
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        input[type="number"] {
            width: 100%;
            padding: 6px;
            border: 1px solid var(--border);
            border-radius: 4px;
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 0.85rem;
            transition: border-color 0.3s;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: var(--accent);
        }

        .radio-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 10px;
        }

        .radio-option {
            position: relative;
        }

        .radio-option input[type="radio"] {
            position: absolute;
            opacity: 0;
        }

        .radio-option label {
            display: block;
            padding: 8px;
            border: 2px solid var(--border);
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background-color: var(--bg-tertiary);
            margin-bottom: 0;
            font-size: 0.85rem;
        }

        /* éšç´šå°ˆå±¬é¡è‰²æ•ˆæœ */
        .radio-option input[type="radio"][value="1"]:checked + label {
            border-color: var(--rare-color);
            background-color: rgba(93, 173, 226, 0.1);
            color: var(--rare-color);
            box-shadow: 0 0 10px rgba(93, 173, 226, 0.3);
        }

        .radio-option input[type="radio"][value="2"]:checked + label {
            border-color: var(--epic-color);
            background-color: rgba(165, 105, 189, 0.1);
            color: var(--epic-color);
            box-shadow: 0 0 15px rgba(165, 105, 189, 0.4);
            text-shadow: 0 0 10px rgba(165, 105, 189, 0.6);
        }

        .radio-option input[type="radio"][value="3"]:checked + label {
            border-color: var(--unique-color);
            background-color: rgba(241, 196, 15, 0.1);
            color: var(--unique-color);
            box-shadow: 0 0 20px rgba(241, 196, 15, 0.5);
            animation: uniqueGlow 2s ease-in-out infinite;
        }

        .radio-option input[type="radio"][value="4"]:checked + label {
            border-color: var(--legendary-color);
            background-color: rgba(46, 204, 113, 0.1);
            color: var(--legendary-color);
            box-shadow: 0 0 25px rgba(46, 204, 113, 0.6);
            animation: legendaryGlow 1.5s ease-in-out infinite;
        }

        @keyframes uniqueGlow {
            0%, 100% {
                text-shadow: 0 0 10px rgba(241, 196, 15, 0.8),
                            0 0 20px rgba(241, 196, 15, 0.6),
                            0 0 30px rgba(241, 196, 15, 0.4);
            }
            50% {
                text-shadow: 0 0 20px rgba(241, 196, 15, 1),
                            0 0 30px rgba(241, 196, 15, 0.8),
                            0 0 40px rgba(241, 196, 15, 0.6);
            }
        }

        @keyframes legendaryGlow {
            0%, 100% {
                text-shadow: 0 0 10px rgba(46, 204, 113, 0.8),
                            0 0 20px rgba(46, 204, 113, 0.6),
                            0 0 30px rgba(46, 204, 113, 0.4);
            }
            50% {
                text-shadow: 0 0 20px rgba(46, 204, 113, 1),
                            0 0 30px rgba(46, 204, 113, 0.8),
                            0 0 40px rgba(46, 204, 113, 0.6);
            }
        }

        .results {
            display: none;
            animation: fadeIn 0.5s;
            overflow-y: auto;
            flex: 1;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-item {
            background-color: var(--bg-tertiary);
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 6px;
            border-left: 3px solid var(--success);
            font-size: 0.75rem;
            line-height: 1.4;
        }

        .result-item strong {
            color: var(--accent);
        }

        .summary {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1) 0%, rgba(254, 202, 87, 0.1) 100%);
            border: 2px solid var(--accent);
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            text-align: center;
        }

        .summary h3 {
            margin-bottom: 5px;
            color: var(--accent);
            font-size: 0.9rem;
        }

        .summary p {
            font-size: 0.8rem;
            margin-bottom: 3px;
        }

        .error-message {
            background-color: rgba(244, 67, 54, 0.1);
            border: 2px solid var(--error);
            color: var(--error);
            padding: 6px;
            border-radius: 4px;
            margin-top: 8px;
            text-align: center;
            display: none;
            font-size: 0.75rem;
        }

        /* å¹³æ¿å„ªåŒ– */
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr 1fr;
                grid-template-rows: auto 1fr;
                max-height: none;
            }
            
            .results-container {
                grid-column: 1 / -1;
            }
        }

        /* æ‰‹æ©Ÿå„ªåŒ– */
        @media (max-width: 600px) {
            .container {
                height: auto;
                min-height: 100vh;
                padding: 5px;
            }

            h1 {
                font-size: 1.2rem;
                margin-bottom: 8px;
            }

            .main-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .card {
                padding: 10px;
            }

            .radio-group {
                grid-template-columns: 1fr;
            }
        }

        /* çµæœå®¹å™¨æ»¾å‹•æ¢æ¨£å¼ */
        .results::-webkit-scrollbar {
            width: 6px;
        }

        .results::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 3px;
        }

        .results::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 3px;
        }

        .results::-webkit-scrollbar-thumb:hover {
            background: var(--accent-hover);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ æ¥“ä¹‹è°·æ½›èƒ½èŠ±è²»è¨ˆç®— ğŸ</h1>

        <div class="main-grid">
            <!-- æ–¹å¡Šåƒ¹æ ¼è¨­å®š -->
            <div class="card">
                <h2 class="section-title">æ–¹å¡Šåƒ¹æ ¼è¨­å®š</h2>
                <div class="input-group">
                    <label for="occultPrice">Occult Cube åƒ¹æ ¼</label>
                    <input type="number" id="occultPrice" min="0" step="0.01" placeholder="è¼¸å…¥åƒ¹æ ¼" oninput="autoCalculate()" onchange="autoCalculate()">
                </div>
                <div class="input-group">
                    <label for="redPrice">Red Cube åƒ¹æ ¼</label>
                    <input type="number" id="redPrice" min="0" step="0.01" placeholder="è¼¸å…¥åƒ¹æ ¼" oninput="autoCalculate()" onchange="autoCalculate()">
                </div>
                <div class="input-group">
                    <label for="blackPrice">Black Cube åƒ¹æ ¼</label>
                    <input type="number" id="blackPrice" min="0" step="0.01" placeholder="è¼¸å…¥åƒ¹æ ¼" oninput="autoCalculate()" onchange="autoCalculate()">
                </div>
            </div>

            <!-- éšç´šè¨­å®š -->
            <div class="card">
                <h2 class="section-title">éšç´šè¨­å®š</h2>
                <div class="input-group">
                    <label>ç•¶å‰è£å‚™éšç´š</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="currentRare" name="current" value="1" onchange="autoCalculate()">
                            <label for="currentRare">Rare</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="currentEpic" name="current" value="2" onchange="autoCalculate()">
                            <label for="currentEpic">Epic</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="currentUnique" name="current" value="3" onchange="autoCalculate()">
                            <label for="currentUnique">Unique</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="currentLegendary" name="current" value="4" onchange="autoCalculate()">
                            <label for="currentLegendary">Legendary</label>
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <label>ç›®æ¨™è£å‚™éšç´š</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="targetRare" name="target" value="1" onchange="autoCalculate()">
                            <label for="targetRare">Rare</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="targetEpic" name="target" value="2" onchange="autoCalculate()">
                            <label for="targetEpic">Epic</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="targetUnique" name="target" value="3" onchange="autoCalculate()">
                            <label for="targetUnique">Unique</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="targetLegendary" name="target" value="4" onchange="autoCalculate()">
                            <label for="targetLegendary">Legendary</label>
                        </div>
                    </div>
                </div>
                <div class="error-message" id="errorMessage"></div>
            </div>

            <!-- è¨ˆç®—çµæœ -->
            <div class="card results-container">
                <h2 class="section-title">è¨ˆç®—çµæœ</h2>
                <div class="results" id="results">
                    <div id="resultContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å„æ–¹å¡Šå‡ç´šæ©Ÿç‡ï¼ˆ%ï¼‰
        const probs = {
            "Occult Cube": {"Rareâ†’Epic": 0.9901},
            "Red Cube": {
                "Rareâ†’Epic": 6.0,
                "Epicâ†’Unique": 1.8,
                "Uniqueâ†’Legendary": 0.3
            },
            "Black Cube": {
                "Rareâ†’Epic": 15.0,
                "Epicâ†’Unique": 3.5,
                "Uniqueâ†’Legendary": 1.0
            }
        };

        const rankMap = {
            '1': 'Rare',
            '2': 'Epic',
            '3': 'Unique',
            '4': 'Legendary'
        };

        const rankMapChinese = {
            'Rare': 'ç¨€æœ‰',
            'Epic': 'å²è©©',
            'Unique': 'ç¨ç‰¹',
            'Legendary': 'å‚³èªª'
        };

        const stageNames = ["Rareâ†’Epic", "Epicâ†’Unique", "Uniqueâ†’Legendary"];
        const idxMap = {'Rare': 0, 'Epic': 1, 'Unique': 2, 'Legendary': 3};

        // åŠ å…¥é˜²æŠ–æ©Ÿåˆ¶ä»¥æå‡æ•ˆèƒ½
        let calculateTimeout;
        
        function autoCalculate() {
            // æ¸…é™¤ä¹‹å‰çš„è¨ˆæ™‚å™¨
            clearTimeout(calculateTimeout);
            
            // æ¸…é™¤éŒ¯èª¤è¨Šæ¯
            document.getElementById('errorMessage').style.display = 'none';
            
            // è¨­å®šæ–°çš„è¨ˆæ™‚å™¨ï¼Œå»¶é²100msåŸ·è¡Œ
            calculateTimeout = setTimeout(() => {
                // æª¢æŸ¥æ˜¯å¦æ‰€æœ‰å¿…è¦çš„è¼¸å…¥éƒ½å·²å¡«å¯«
                const occultPrice = document.getElementById('occultPrice').value;
                const redPrice = document.getElementById('redPrice').value;
                const blackPrice = document.getElementById('blackPrice').value;
                const currentRadio = document.querySelector('input[name="current"]:checked');
                const targetRadio = document.querySelector('input[name="target"]:checked');
                
                // å¦‚æœæœ‰ä»»ä½•å¿…è¦è¼¸å…¥æœªå¡«å¯«ï¼Œå‰‡ä¸è¨ˆç®—
                if (!occultPrice || !redPrice || !blackPrice || !currentRadio || !targetRadio) {
                    document.getElementById('results').style.display = 'none';
                    return;
                }
                
                // åŸ·è¡Œè¨ˆç®—
                calculate();
            }, 100);
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            document.getElementById('results').style.display = 'none';
        }

        function calculate() {
            // æ¸…é™¤å…ˆå‰çš„éŒ¯èª¤è¨Šæ¯
            document.getElementById('errorMessage').style.display = 'none';

            // å–å¾—åƒ¹æ ¼
            const costs = {
                "Occult Cube": parseFloat(document.getElementById('occultPrice').value),
                "Red Cube": parseFloat(document.getElementById('redPrice').value),
                "Black Cube": parseFloat(document.getElementById('blackPrice').value)
            };

            // æª¢æŸ¥åƒ¹æ ¼æ˜¯å¦æœ‰æ•ˆ
            if (isNaN(costs["Occult Cube"]) || isNaN(costs["Red Cube"]) || isNaN(costs["Black Cube"]) || 
                costs["Occult Cube"] <= 0 || costs["Red Cube"] <= 0 || costs["Black Cube"] <= 0) {
                showError('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ–¹å¡Šåƒ¹æ ¼ï¼');
                return;
            }

            // å–å¾—ç•¶å‰å’Œç›®æ¨™éšç´š
            const currentRadio = document.querySelector('input[name="current"]:checked');
            const targetRadio = document.querySelector('input[name="target"]:checked');

            if (!currentRadio || !targetRadio) {
                showError('è«‹é¸æ“‡ç•¶å‰å’Œç›®æ¨™éšç´šï¼');
                return;
            }

            const curRank = rankMap[currentRadio.value];
            const tgtRank = rankMap[targetRadio.value];
            const curIdx = idxMap[curRank];
            const tgtIdx = idxMap[tgtRank];

            if (tgtIdx <= curIdx) {
                if (tgtIdx === curIdx) {
                    showError('ç•¶å‰å·²æ˜¯ç›®æ¨™éšç´šï¼Œç„¡éœ€å‡éšï¼');
                } else {
                    showError('ç›®æ¨™éšç´šä¸èƒ½ä½æ–¼ç•¶å‰éšç´šï¼');
                }
                return;
            }

            let totalTries = 0;
            let totalCost = 0;
            let resultHTML = '';

            // è¨ˆç®—æ¯å€‹éšæ®µ
            for (let i = curIdx; i < tgtIdx; i++) {
                const stage = stageNames[i];
                const candidates = {};

                // ç¯©é¸å¯ç”¨æ–¹å¡Š
                for (const [cube, sp] of Object.entries(probs)) {
                    if (stage in sp && !(cube === "Occult Cube" && stage !== "Rareâ†’Epic")) {
                        const rate = sp[stage] / 100.0;
                        const avgTries = 1 / rate;
                        const avgCost = avgTries * costs[cube];
                        candidates[cube] = {tries: avgTries, cost: avgCost};
                    }
                }

                // æ‰¾å‡ºæœ€ä½³æ–¹æ¡ˆ
                let bestCube = null;
                let bestData = {cost: Infinity};

                for (const [cube, data] of Object.entries(candidates)) {
                    if (data.cost < bestData.cost) {
                        bestCube = cube;
                        bestData = data;
                    }
                }

                totalTries += bestData.tries;
                totalCost += bestData.cost;

                resultHTML += `
                    <div class="result-item">
                        <strong>${stage}</strong> â†’ æ¨è–¦ï¼š<strong>${bestCube}</strong>
                        <br>å¹³å‡ <strong>${bestData.tries.toFixed(2)}</strong> æ¬¡ï¼ŒèŠ±è²» <strong>${bestData.cost.toFixed(2)}</strong>
                    </div>
                `;
            }

            // ç¸½çµ
            resultHTML += `
                <div class="summary">
                    <h3>ç¸½è¨ˆ</h3>
                    <p>å¾ <strong>${rankMapChinese[curRank]}</strong> â†’ <strong>${rankMapChinese[tgtRank]}</strong></p>
                    <p>å¹³å‡ç¸½æ¬¡æ•¸ï¼š<strong>${totalTries.toFixed(2)}</strong> æ¬¡</p>
                    <p>å¹³å‡ç¸½èŠ±è²»ï¼š<strong>${totalCost.toFixed(2)}</strong></p>
                </div>
            `;

            // é¡¯ç¤ºçµæœ
            document.getElementById('resultContent').innerHTML = resultHTML;
            document.getElementById('results').style.display = 'block';
        }

        // Enter éµè§¸ç™¼è¨ˆç®—
        document.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                autoCalculate();
            }
        });
    </script>
</body>
</html>
